<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-16">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/assets/style.css">
    

    <title></title>
  </head>
  <body>
    <div class="container-fluid">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/">
          <img src="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/assets/img/haal_centraal_zon_geel_RGB.png" width="238px">
        </a>
        <span class="navbar-text">BRP API Personen</span>
        
          <a class="navbar-brand-right" href="http://www.rvig.nl/" target="_blank">
            <img src="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/assets/img/BZK_RIG_Logo_online_ex_pos_nl.png" width="238px">
          </a>
        
      </nav>
      <div style="height: 0px; border-top: 1px solid #b1b1b1;box-shadow: 0 -5px 5px -5px #7c7c7c;"></div>
      <nav class="navbar navbar-expand-lg navbar-light bg-light" style="text-align: right;">
        <div class="collapse navbar-collapse">
    <ul class="navbar-nav mx-auto">
      <li class="nav-item active">
        <a class="nav-link" href="https://vng-realisatie.github.io/Haal-Centraal/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Starten met Haal Centraal
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/starten-met-haal-centraal">Startgids</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/transitieplan">Transitieplan</a>
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/security">Security</a>
       </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Aansluiten op API's
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/aansluiten-op-apis">Aansluiten op API's</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://lvbag.github.io/BAG-Gemeentelijke-wensen-tav-BAG-Bevragingen/">BAG Individuele Bevragingen (live)</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://kadaster.github.io/BRK-bevragen/">BRK Bevragen (live)</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://brp-api.github.io/Haal-Centraal-BRP-bevragen/">BRP Persoon (live)</a>
          <a class="dropdown-item" href="https://brp-api.github.io/Haal-Centraal-BRP-historie-bevragen/">BRP Historie (live)</a>
          <a class="dropdown-item" href="https://brp-api.github.io/Haal-Centraal-BRP-bewoning/">BRP Bewoning (live)</a>
          <a class="dropdown-item" href="https://brp-api.github.io/Haal-Centraal-Reisdocumenten-bevragen//">BRP Reisdocumenten (live)</a>
          <a class="dropdown-item" href="https://brp-api.github.io/Haal-Centraal-BRP-tabellen-bevragen/">BRP Tabellen</a>
          <a class="dropdown-item" href="https://brp-api.github.io/Haal-Centraal-BRP-Update-API/">BRP Update API</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://kadaster.github.io/WOZ-bevragen/">WOZ Bevragen (live)</a>
       </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Bijdragen aan API's</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/hoe-kun-je-bijdragen">Bijdragen aan API's</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/bug_melden">Bug melden</a>
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/verbetervoorstel">Verbetervoorstel</a>
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/gebruikerswens">Gebruikerswens</a>
       </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link" href="https://vng-realisatie.github.io/Haal-Centraal/over-haal-centraal">Over Haal Centraal</a>
<!--        <a class="nav-link dropdown" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Over Haal Centraal</a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="https://vng-realisatie.github.io/Haal-Centraal/planning">Planning</a>
       </div-->
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://vng-realisatie.github.io/Haal-Centraal/contact">Contact</a>
      </li>
    </ul>
</div>

      </nav>
    </div>
    <div class="container-fluid">
    <div class="row">
        <div class="col-2">
	<div class="header">BRP Personen Bevragen</div>
	<nav class="nav flex-column">
    
      
	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/" target="">Main</a>

	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/goals-canvas" target="">Goals canvas</a>

    
  
	<div class="header">Specificaties v. 2</div>
	<nav class="nav flex-column">
    
      
	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/releasenotes" target="">Releasenotes</a>

	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/v2/getting-started" target="">Getting started</a>

	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/user-stories-prod" target="">User stories</a>

	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/v2/redoc" target="">Bevragen API</a>

	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/v2/features-overzicht" target="">Features overzicht</a>

	
	<a class="nav-link" href="/Haal-Centraal-BRP-bevragen/pr-preview/pr-1908/features/index" target="">Features test overzicht</a>

    
  
</nav>
</div>
        <div class="col-9"><style>
  .check-tree li {
    list-style-type: none
  }

  #fields {
    width: 100%;
  }

  .hidden {
    display: none;
  }

  .toggleButton {
    border-radius: 50%;
    font-family: monospace;
    font-weight: 800;
    cursor: pointer;
    padding: 0px 5px;
  }
</style>

<h1 id="fields-samenstellen">Fields samenstellen</h1>
<p>Bij het gebruik van de BRP API Personen moet in de fields parameter worden opgegeven welke gegevens je wilt ontvangen.
Hieronder bieden we een tool om de waarde voor de fields parameter samen te stellen. Hiervoor selecteer je elk veld dat je wilt ontvangen.</p>

<p>Meer details over hoe fields werkt lees je in het <a href="./features-overzicht#filteren-van-de-velden-van-de-gevonden-personen" target="_blank" rel="noopener">feature overzicht</a></p>

<p>Sommige gegevens krijg je <a href="./features-overzicht#standaard-geleverde-velden">automatisch geleverd</a>, dus die hoef en mag je niet vragen.</p>

<p>Velden onder <a href="./features-overzicht#filteren-van-verblijfplaats-velden" target="_blank" rel="noopener">verblijfplaatsBinnenland</a> en <a href="./features-overzicht#filteren-van-adresregels-velden" target="_blank" rel="noopener">adresseringBinnenland</a> gebruik je wanneer je wel het adres wilt opvragen, maar niet geautoriseerd bent voor buitenlandse adressen.</p>

<h2 id="1-selecteer-het-zoektype">1. selecteer het zoektype</h2>
<p>Met fields mag je alleen vragen om gegevens die bij het vraagtype teruggegeven kunnen worden. Daarom selecteer je eerst het type vraag dat je wilt doen.</p>

<p><select id="searchType" class="form-control" onchange="loadFieldsList()">
  <option value="Persoon">RaadpleegMetBurgerservicenummer</option>
  <option value="PersoonBeperkt">ZoekMet...</option>
  <option value="GezagPersoonBeperkt">ZoekMetAdresseerbaarObjectIdentificatie</option>
</select></p>

<h2 id="2-selecteer-de-velden-die-je-wilt-ontvangen">2. selecteer de velden die je wilt ontvangen</h2>

<div id="selectors"></div>

<h2 id="3-kopieer-de-waarde-hieronder-en-gebruik-dit-in-je-request-bij-de-fields-parameter">3. kopieer de waarde hieronder en gebruik dit in je request bij de fields parameter</h2>

<textarea id="fields" class="form-control"></textarea>

<script>
  loadFieldsList();


  function loadFieldsList() {
    // haal de lijst met toegestane velden op voor het geselecteerde type
  
    document.getElementById("fields").value = "";

    var responseObjectName = document.getElementById("searchType").value;

    var ajaxRequest = new XMLHttpRequest();
    ajaxRequest.onreadystatechange = function(){
      if(ajaxRequest.readyState == 4){
        if(ajaxRequest.status == 200){
          renderFieldSelectors(responseObjectName, ajaxRequest.responseText.split(/\r?\n/))
        } else {
          document.getElementById("selectors").innerHTML = "Status error: " + ajaxRequest.status;
        }
      }
    }

    ajaxRequest.open("GET", "https://raw.githubusercontent.com/BRP-API/Haal-Centraal-BRP-bevragen/master/features/fields-filtered-" + responseObjectName + ".csv", true);
    ajaxRequest.send();
  }

  function renderFieldSelectors(responseObjectName, fieldsList) {
    // maak de lijst met velden inclusief checkboxes
  
    fieldsList.shift(); // kolomkop overslaan

    var selectors = document.getElementById("selectors");
    selectors.innerHTML = '<ul id="fields-tree" class="check-tree"></ul>';
    addTreeItem(fieldsList);
    hideUselessToggleButtons();
  }

  function addTreeItem(fieldsList) {
    // voeg volgende veld toe als checkbox
  
    if (fieldsList.length == 0) { return; }

    var field = fieldsList.shift();
    if (field=="") { addTreeItem(fieldsList); return; }

    var parent = document.getElementById("fields-tree");
    if (field.split('.').length > 1) { parent = document.getElementById(field.split('.').slice(0, -1).join('.') + '-list'); }

    li = document.createElement('li');
    li.innerHTML = `<input type="checkbox" id="${field}" class="form-check-input" onchange="click_item(this)"/> `;
    li.innerHTML += field.split('.').slice(-1);
    li.innerHTML += ` <button id="${field}-toggle" onclick="toggleGroupFields('${field}')" class="btn btn-light toggleButton">+</button>`;
    li.innerHTML += `<ul id="${field}-list" class="hidden"></ul>`;
    parent.appendChild(li);

    addTreeItem(fieldsList);
  }

  function hideUselessToggleButtons() {
    // verberg toggle knopjes (+/- voor het openen van een groep) voor alle velden die geen groep zijn
  
    for (element of document.getElementById("fields-tree").getElementsByTagName("li")) {
      var id = element.getElementsByTagName("input")[0].id;
      if (document.getElementById(id + '-list').children.length == 0) {
        document.getElementById(id + '-toggle').classList.add("hidden");
      }
    }
  }

  function click_item(item) {
    // verwerk wijziging in checkbox status op een veld
  
    setChildren(item); // wanneer het gewijzigde veld een groep is, nemen alle velden in de groep de status van de groep over
    setParent(item); // wanneer het gewijzigde veld in een groep zit, moet de status van het groepsveld worden bijgewerkt
    setFields(); // stel de fields parameter samen op basis van de geselecteerde velden
  }

  function setChildren(item) {
    // wanneer het veld een groep is, nemen alle velden in de groep de status van de groep over
  
    if (document.getElementById(item.id + "-list").children.length > 0)
    {
      for (child of document.getElementById(item.id + "-list").children) {
        child.getElementsByTagName("input")[0].checked = item.checked;
        child.getElementsByTagName("input")[0].indeterminate = false;
        setChildren(child.getElementsByTagName("input")[0])
      }
    }
  }

  function setParent(item) {
    // wanneer het veld in een groep zit, moet de status van het groepsveld worden bijgewerkt
  
    if (item.id.split('.').length < 2) { return; } // veld zit niet in een groep

    parentId = item.id.split('.').slice(0, -1).join('.');
    parent = document.getElementById(parentId);

    determineCheckStatus(parent);

    setParent(parent);
  }

  function determineCheckStatus(item) {
    //bepaal de status van een groepsveld (item) op basis van de status van de velden in de groep
                                      
    var checked = 0;
    var notChecked = 0;

    for (child of document.getElementById(item.id + "-list").children) {
      if (child.getElementsByTagName("input")[0].checked == true) { 
        checked += 1; 
      } else if ( child.getElementsByTagName("input")[0].indeterminate == true) {
        checked += 1;
        notChecked += 1;
      } else {
        notChecked += 1;
      }
    }

    if (checked > 0 && notChecked == 0) {
      // alle velden van de groep zijn aangevinkt, dus de hele groep wordt gevraagd
      item.checked = true;
      item.indeterminate = false;
      return;
    }
    if (checked > 0 && notChecked > 0) {
      // enkele, maar niet alle velden van de groep zijn gevraagd
      item.checked = false;
      item.indeterminate = true;
      return;
    }

    // checked == 0: geen enkel veld in de groep is aangevinkt
    item.checked = false;
    item.indeterminate = false;
  }

  function setFields() {
    // stel de fields parameter samen op basis van de geselecteerde velden
  
    fields = [];

    elements = document.getElementById("fields-tree").getElementsByTagName("input");
    for (element of elements) {
      if (element.id.split('.').length > 1) {
        parentId = element.id.split('.').slice(0, -1).join('.');
        if (document.getElementById(parentId).checked == true) { continue; }
      }

      if (element.checked == true) { fields.push(element.id); }
    };

    document.getElementById("fields").value = JSON.stringify(fields);
  }

  function toggleGroupFields(group) {
    // toon of verberg de velden binnen de groep
  
    var list = document.getElementById(group + '-list');
    var toggleButton = document.getElementById(group + '-toggle');
    if (list.classList.contains('hidden')) {
      list.classList.remove('hidden');
      toggleButton.innerHTML = '-';
    } else {
      list.classList.add('hidden');
      toggleButton.innerHTML = '+';
    }
  }
</script>

</div>
    </div>
</div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    
  </body>
</html>
